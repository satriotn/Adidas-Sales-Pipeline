[2024-11-08T09:37:03.047+0000] {taskinstance.py:1979} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: etl_csv_file.insert_to_db manual__2024-11-08T09:36:58.985872+00:00 [queued]>
[2024-11-08T09:37:03.084+0000] {taskinstance.py:1979} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: etl_csv_file.insert_to_db manual__2024-11-08T09:36:58.985872+00:00 [queued]>
[2024-11-08T09:37:03.085+0000] {taskinstance.py:2193} INFO - Starting attempt 1 of 1
[2024-11-08T09:37:03.146+0000] {taskinstance.py:2217} INFO - Executing <Task(_PythonDecoratedOperator): insert_to_db> on 2024-11-08 09:36:58.985872+00:00
[2024-11-08T09:37:03.154+0000] {standard_task_runner.py:60} INFO - Started process 198 to run task
[2024-11-08T09:37:03.164+0000] {standard_task_runner.py:87} INFO - Running: ['airflow', 'tasks', 'run', 'etl_csv_file', 'insert_to_db', 'manual__2024-11-08T09:36:58.985872+00:00', '--job-id', '2', '--raw', '--subdir', 'DAGS_FOLDER/etl_csv_file.py', '--cfg-path', '/tmp/tmp1o6dbwhj']
[2024-11-08T09:37:03.168+0000] {standard_task_runner.py:88} INFO - Job 2: Subtask insert_to_db
[2024-11-08T09:37:03.311+0000] {task_command.py:423} INFO - Running <TaskInstance: etl_csv_file.insert_to_db manual__2024-11-08T09:36:58.985872+00:00 [running]> on host fcf5fca827a9
[2024-11-08T09:37:03.494+0000] {taskinstance.py:2513} INFO - Exporting env vars: AIRFLOW_CTX_DAG_OWNER='Satrio' AIRFLOW_CTX_DAG_ID='etl_csv_file' AIRFLOW_CTX_TASK_ID='insert_to_db' AIRFLOW_CTX_EXECUTION_DATE='2024-11-08T09:36:58.985872+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='manual__2024-11-08T09:36:58.985872+00:00'
[2024-11-08T09:37:04.792+0000] {taskinstance.py:2731} ERROR - Task failed with exception
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1910, in _execute_context
    self.dialect.do_execute(
  File "/home/airflow/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 736, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.UniqueViolation: duplicate key value violates unique constraint "pg_type_typname_nsp_index"
DETAIL:  Key (typname, typnamespace)=(adidas_sales_raw, 2200) already exists.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.8/site-packages/airflow/models/taskinstance.py", line 444, in _execute_task
    result = _execute_callable(context=context, **execute_callable_kwargs)
  File "/home/airflow/.local/lib/python3.8/site-packages/airflow/models/taskinstance.py", line 414, in _execute_callable
    return execute_callable(context=context, **execute_callable_kwargs)
  File "/home/airflow/.local/lib/python3.8/site-packages/airflow/decorators/base.py", line 241, in execute
    return_value = super().execute(context)
  File "/home/airflow/.local/lib/python3.8/site-packages/airflow/operators/python.py", line 200, in execute
    return_value = self.execute_callable()
  File "/home/airflow/.local/lib/python3.8/site-packages/airflow/operators/python.py", line 217, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
  File "/opt/airflow/dags/etl_csv_file.py", line 35, in insert_to_db
    df.to_sql('adidas_sales_raw', conn, index=False, if_exists='replace')
  File "/home/airflow/.local/lib/python3.8/site-packages/pandas/core/generic.py", line 2878, in to_sql
    return sql.to_sql(
  File "/home/airflow/.local/lib/python3.8/site-packages/pandas/io/sql.py", line 769, in to_sql
    return pandas_sql.to_sql(
  File "/home/airflow/.local/lib/python3.8/site-packages/pandas/io/sql.py", line 1910, in to_sql
    table = self.prep_table(
  File "/home/airflow/.local/lib/python3.8/site-packages/pandas/io/sql.py", line 1814, in prep_table
    table.create()
  File "/home/airflow/.local/lib/python3.8/site-packages/pandas/io/sql.py", line 914, in create
    self._execute_create()
  File "/home/airflow/.local/lib/python3.8/site-packages/pandas/io/sql.py", line 900, in _execute_create
    self.table.create(bind=self.pd_sql.con)
  File "/home/airflow/.local/lib/python3.8/site-packages/sqlalchemy/sql/schema.py", line 962, in create
    bind._run_ddl_visitor(ddl.SchemaGenerator, self, checkfirst=checkfirst)
  File "/home/airflow/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 2221, in _run_ddl_visitor
    visitorcallable(self.dialect, self, **kwargs).traverse_single(element)
  File "/home/airflow/.local/lib/python3.8/site-packages/sqlalchemy/sql/visitors.py", line 524, in traverse_single
    return meth(obj, **kw)
  File "/home/airflow/.local/lib/python3.8/site-packages/sqlalchemy/sql/ddl.py", line 899, in visit_table
    self.connection.execute(
  File "/home/airflow/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1385, in execute
    return meth(self, multiparams, params, _EMPTY_EXECUTION_OPTS)
  File "/home/airflow/.local/lib/python3.8/site-packages/sqlalchemy/sql/ddl.py", line 80, in _execute_on_connection
    return connection._execute_ddl(
  File "/home/airflow/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1477, in _execute_ddl
    ret = self._execute_context(
  File "/home/airflow/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1953, in _execute_context
    self._handle_dbapi_exception(
  File "/home/airflow/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 2134, in _handle_dbapi_exception
    util.raise_(
  File "/home/airflow/.local/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 211, in raise_
    raise exception
  File "/home/airflow/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1910, in _execute_context
    self.dialect.do_execute(
  File "/home/airflow/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 736, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.IntegrityError: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "pg_type_typname_nsp_index"
DETAIL:  Key (typname, typnamespace)=(adidas_sales_raw, 2200) already exists.

[SQL: 
CREATE TABLE adidas_sales_raw (
	"Unnamed: 0" BIGINT, 
	"Invoice Id" BIGINT, 
	"Retailer" TEXT, 
	"Retailer ID" BIGINT, 
	"Invoice Date" TEXT, 
	"Region" TEXT, 
	"State" TEXT, 
	"City" TEXT, 
	"Product" TEXT, 
	"Price per Unit" FLOAT(53), 
	"Units Sold" FLOAT(53), 
	"Total Sales" BIGINT, 
	"Operating Profit" BIGINT, 
	"Operating Margin" BIGINT, 
	"Sales Method" TEXT
)

]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
[2024-11-08T09:37:04.914+0000] {taskinstance.py:1149} INFO - Marking task as FAILED. dag_id=etl_csv_file, task_id=insert_to_db, execution_date=20241108T093658, start_date=20241108T093703, end_date=20241108T093704
[2024-11-08T09:37:04.938+0000] {standard_task_runner.py:107} ERROR - Failed to execute job 2 for task insert_to_db ((psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "pg_type_typname_nsp_index"
DETAIL:  Key (typname, typnamespace)=(adidas_sales_raw, 2200) already exists.

[SQL: 
CREATE TABLE adidas_sales_raw (
	"Unnamed: 0" BIGINT, 
	"Invoice Id" BIGINT, 
	"Retailer" TEXT, 
	"Retailer ID" BIGINT, 
	"Invoice Date" TEXT, 
	"Region" TEXT, 
	"State" TEXT, 
	"City" TEXT, 
	"Product" TEXT, 
	"Price per Unit" FLOAT(53), 
	"Units Sold" FLOAT(53), 
	"Total Sales" BIGINT, 
	"Operating Profit" BIGINT, 
	"Operating Margin" BIGINT, 
	"Sales Method" TEXT
)

]
(Background on this error at: https://sqlalche.me/e/14/gkpj); 198)
[2024-11-08T09:37:04.979+0000] {local_task_job_runner.py:234} INFO - Task exited with return code 1
[2024-11-08T09:37:05.030+0000] {taskinstance.py:3312} INFO - 0 downstream tasks scheduled from follow-on schedule check
